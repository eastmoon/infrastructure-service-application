# Infrastructure Service Application

## 簡介

系統的基礎設施 ( Infrastructure ) 是指諸多完善且可運行的開源或閉源軟體，藉由運用此些軟體來補充系統的軟體服務基礎，讓開發的軟體能基於此些服務繼續擴大應用方面；例如，伺服器端 API 服務會配合相應的資料庫基礎設施。

在微服物系統中，應用程式開通常會配置相應的基礎設施；然而，有些基礎設施提供的服務本身就是奠基在諸多互些串聯運作，例如藉由雲端儲存服務儲存伺服器日誌與數據，並經由流處理統計與分析，將相應結果提供給數據視覺化軟體呈現。

在這種多基礎設施串聯構成的服務結構中，需提供基礎設施配置、執行、管理的流程與介面，從而讓其他應用程式能藉由遠端服務操控。

基於上述概念，基礎設施服務應用程式是將對基礎設施的配置、執行、管理方法以容器封裝的服務應用程式，其專案基礎源於 [Algorithm service Application](https://github.com/eastmoon/algorithm-service-application) 的 FastAPI 框架，藉由處理 yaml 或 json 的配置資訊，進而控制與管理相應的基礎設施容器；因此，該服務應用程式應包括下述特性：

+ 對 Host 的容器操作
+ 具有相關服務的配置目錄
	- 依據服務名稱目錄在 /infra 目錄下
+ 服務包括以下行為
	- 列舉
		+ 工作流配置檔
		+ 服務項目
	- 建置工作流配置檔
		+ 依據工作流需要添加配置資訊與行為
		+ 對於可配置的服務對象，應為可添加的項目
	- 執行工作流配置檔
		+ 解析 yaml 與 json 檔案
		+ 依據配置檔提供不同服務需要的配置檔 ( configuration file ) 與服務內容建置 ( Service API )
		+ 依據需要判斷是否重啟該服務
+ DevOps CLI
	- dev : 開發服務配置與服務操控
	- pub : 發佈包括控制腳本與相關的容器服務配置檔
	- pack：將服務配置檔與相關內容產出映像檔，並增加啟動腳

## 適用情境

+ 封裝基礎建設項目的服務配置、執行、控制相關函式庫與腳本
+ 封裝內容為映像檔，可提供給其他容器服務系統使用
+ 基礎建設的執行目錄為固定

## 開發環境

本專案預設於 Windows 環境設計，相關操作指令如下：

#### 啟動環境

使用以下命令會啟動開發容器。

```
isa.bat dev
```

開發模式中會掛起不同目錄以便開發細節

+ ```/app``` 目錄會掛入專案目錄 ```app``` ，用於基礎設施模組開發，亦是容器指定的工作目錄
+ ```/usr/local/isa``` 目錄會掛入專案目錄 ```conf/docker/cli```，用於服務命令介面開發
+ ```/usr/local/fastapi``` 目錄會掛入專案目錄 ```conf/docker/api```，用於 WebAPI 服務開發/

開發模式會啟動 WebAPI 服務，可透過 HOST 主機連線則使用 ```http://localhost:8080``` 網址，並執行有開啟的路徑以執行相應的服務命令介面。

開發容器啟動後有提供以下選項進行額外操作：

+ ```isa.bat dev --into```：進入開發容器
+ ```isa.bat dev --stop```：關閉開發容器

#### 服務命令介面

服務命令介面為容器內提供的 ```isa``` 命令介面，要執行相關指令必須先啟動開發環境並進入容器：

```
# 啟動開發容器
isa.bat dev
# 進入開發容器
isa.bat dev --into
```

服務命令介面包括以下功能：

+ ```isa list [modeule_name]```：列舉可供控制的模塊
	- 例如對 nginx 或 kafka 等基礎設施的操作服務
